---
title: "Your Title"
subtitle: "STAT 253 Group Assignment 1"
date: today
author: "Olivia, Adam, and Liam"
format:
  html:
    toc: true
    toc-depth: 3
    embed-resources: true
    code-tools: true
---



<!-- Your report should follow the format specified in the Group Assignment 1 Instructions. Please review that document carefully! -->





```{r}
#| include: false
# Load packages
library(tidyverse)
library(tidymodels)

# resolves package conflicts by preferring tidymodels functions
tidymodels_prefer() 

# if your group needs any other packages, add them here

```





# Research Goals




# Data

```{r}
#| message: false
#| warning: false
#| echo: false

# read in data

flight_train <- read.csv("Flights_Train.csv") 

head(flight_train)

```

```{r}
flight_train_dest_delayed<- flight_train %>% 
  filter(dep_delay>0)
```

```{r}
#| message: false
#| warning: false
#| echo: false

# visualization

ggplot(aes( x=dep_delay, fill=carrier_name), data=flight_train_dest_delayed)+
  geom_bar()
```

```{r}
ggplot(aes(x=dep_delay, fill=dest), data=flight_train_dest_delayed)+
  geom_histogram()
```


```{r}
top_three_delayed <- flight_train_dest_delayed %>%
  arrange(desc(dep_delay)) %>%
  slice(1:5)

top_three_delayed


only_delta<-flight_train_dest_delayed %>% 
  filter(carrier_name=="Delta Air Lines Inc.")
```

```{r}
ggplot(aes( x=dep_delay,fill=carrier_name ), data=only_delta)+
  geom_boxplot()

```

```{r}
ggplot(aes( y=dep_delay,x=dow, fill=carrier_name ), data=only_delta)+
  geom_jitter()
```
```{r}
ggplot(aes( y=dep_delay,x=hour, fill=carrier_name ), data=only_delta)+
  geom_boxplot()
```
```{r}

only_delta_dis_100<-only_delta %>% 
  filter(distance<1800)

ggplot(aes(x=distance, y=dep_delay), data=only_delta_dis_100)+
  geom_point()+
  geom_smooth(method="lm")
```
```{r}
sky_delta <- flight_train_dest_delayed %>%
  filter(carrier_name %in% c("Delta Air Lines Inc.", "SkyWest Airlines Inc."))

ggplot(aes( x=dep_delay), data=sky_delta)+
  geom_bar()+
  facet_wrap(~carrier_name)

```


# Model Building

```{r}
# Define the model specification for a Lasso regression
lasso_spec <- linear_reg() %>%
  set_mode("regression") %>%
  set_engine("glmnet") %>%
  set_args(mixture = 1, penalty = tune())

# Create a recipe for data preprocessing
variable_recipe <- recipe(dep_delay ~ ., data = flight_train_dest_delayed) %>%
  step_nzv(all_predictors()) %>% # Add step_nzv() to remove near-zero variance predictors
  step_dummy(all_nominal_predictors())

# Bundle the recipe and model into a workflow
lasso_workflow <- workflow() %>%
  add_recipe(variable_recipe) %>%
  add_model(lasso_spec)

# Tune the penalty parameter for the Lasso model
set.seed(253)
lasso_models <- lasso_workflow %>%
  tune_grid(
    grid = grid_regular(penalty(range = c(-5, 1)), levels = 100),
    resamples = vfold_cv(flight_train_dest_delayed, v = 10),
    metrics = metric_set(mae)
  )

# Select the most parsimonious penalty within one standard error of the best
parsimonious_penalty <- lasso_models %>%
  select_by_one_std_err(metric = "mae", desc(penalty))

# Print the selected penalty value
parsimonious_penalty

```
```{r}
lasso_workflow %>% 
  finalize_workflow(parameters = parsimonious_penalty) %>% 
  fit(data = flight_train_dest_delayed) %>% 
  tidy() %>% 
  filter(estimate !=0)
```


```{r}
parsimonious_results <- lasso_models %>% 
  collect_metrics() %>% 
  filter(penalty == parsimonious_penalty$penalty)

parsimonious_results
```


# Implementation

We used tidymodels to implement this model building process. See code below for full details.

<details>
<summary>View Code</summary>

```{r}
#| message: false
#| warning: false

# Include all model building code in here.
# Make sure to include comments explaining what your code does.








```

</details>



# Model Evaluation

```{r}
#| message: false
#| warning: false
#| echo: false

# visualization





```


# Validation

```{r}
#| message: false
#| warning: false
#| error: true
# validate final model on test set
# NOTE: don't run this code chunk until you are done with all other parts of your report

Flights_Test <- read_csv('Flights_Test.csv')

___ %>% # name of your final model
  augment(new_data = Flights_Test) %>%
  mae(truth = dep_delay, estimate = .pred)
```




# Contributions




# Appendix

```{r}
#| eval: false
# put code for any other models or visualizations that you considered here
# use comments to explain what your code is doing
```


